# AI 向け規約文書（Daily ノート生成・保守用）

> このドキュメントは GitHub Copilot 等の AI が日次ノート（daily）を生成・修正する際に守るべき規約を定めています。  
> 新規メンバーもこれを読むことでテンプレと文法を理解できます。

---

## 1. 基本原則

- **機械が読むのは `## INDEX` セクションのみ**  
  本文（Summary / Reading Notes / Key Takeaways / Log 等）は自由に書いてよい（長文 OK）
- **INDEX は固定文法**  
  スクリプトが安定してパースできる形式を厳守すること
- **原本へ戻れる設計**  
  各索引項目には必ず Block ID（`^...`）を付与し、Obsidian のブロック参照で原本に戻れるようにする
- **コードブロックは必ず ```` を使う**  
  ``` ではなく ```` で囲むこと

---

## 2. Daily ノートの必須セクション構成

### 2.1 最小構成（必須）

```
---
date: YYYY-MM-DD
tags: []
---

## Summary

（短文でその日の要約）

## Key Takeaways (indexed)

- （ブログ化の核となる要点：3〜7個程度） ^YYYYMMDD-t1
- （...） ^YYYYMMDD-t2

## INDEX

- [learning] ![[00.daily/YYYY-MM-DD.md#^YYYYMMDD-t1]] #book:書籍名 #topic:テーマ ^YYYYMMDD-l1
- [idea] アイデアの短いラベル #topic:workflow ^YYYYMMDD-i1
- [action] 次にやること effort=30 status=inbox #topic:productivity ^YYYYMMDD-a1
```

### 2.2 推奨セクション（任意）

- **Reading / Article Notes**：読書・記事メモ（長文 OK）
- **Log / Reflection**：振り返り・自由記述
- **RAW**：入力原文（後で再整形したい時の保険）

---

## 3. Block ID 命名規則（厳守）

### 3.1 形式

```
^YYYYMMDD-<kind><n>
```

- `YYYYMMDD`：その Daily の日付（ファイル名と一致させる）
- `kind`：用途別の固定文字（以下の表を参照）
- `n`：1 からの連番（同日内で重複しない）

### 3.2 kind 一覧

| kind | 用途                         | 例             |
| ---- | ---------------------------- | -------------- |
| `t`  | takeaway（本文中の核）       | `^20251213-t1` |
| `l`  | learning（索引用の学び項目） | `^20251213-l1` |
| `e`  | experiment（索引用の試行）   | `^20251213-e1` |
| `i`  | idea（索引用のアイデア）     | `^20251213-i1` |
| `a`  | action（索引用のアクション） | `^20251213-a1` |

### 3.3 ❌ NG 例

- `^takeaway1`（日付が無い）
- `^20251213-1`（kind が無い）
- `^2025-12-13-t1`（日付にハイフンが入っている）

---

## 4. INDEX 固定文法（最重要：機械契約）

### 4.1 INDEX セクション検出ルール

- 見出し行が `## INDEX` のセクションを対象とする
- セクション終了は次の `## ` 見出し出現、またはファイル末尾

### 4.2 INDEX 行の必須要素

```
- [TYPE] BODY META? TAGS? ^BLOCK_ID
```

1. **行頭**：`- ` で始まる（Markdown のリスト項目）
2. **TYPE**：`[learning]`, `[experiment]`, `[idea]`, `[action]` のいずれか
3. **BODY**：内容（リンク形式 or テキスト形式）
4. **META**：action の場合のみ必須（`status=<状態>`）
5. **TAGS**：0 個以上の `#prefix:value` 形式タグ
6. **BLOCK_ID**：行末に必ず `^YYYYMMDD-<kind><n>` を付ける

### 4.3 TYPE 別の仕様

#### learning（学び）

- 推奨：`![[00.daily/YYYY-MM-DD.md#^YYYYMMDD-t1]]` で takeaway へリンク
- こうすると文脈へ戻れる

```
- [learning] ![[00.daily/2025-12-13.md#^20251213-t1]] #book:開発生産性の教科書 #topic:reading ^20251213-l1
```

#### experiment（試行）

- 何を試したかの短いラベル

```
- [experiment] Playwright で E2E テスト実装 #tech:playwright #topic:testing ^20251213-e1
```

#### idea（アイデア）

- 短いラベル（1 行で収まる）

```
- [idea] メトリクスの週次レビューを自動化する #topic:workflow ^20251213-i1
```

#### action（アクション）

- **META 必須**：`effort=<分>` と `status=<状態>`
- status は `inbox` / `doing` / `done` / `dropped` のいずれか

```
- [action] 週次で指標を1つ決める effort=30 status=inbox #topic:productivity ^20251213-a1
```

### 4.4 ✅ OK 例

```
## INDEX

- [learning] ![[00.daily/2025-12-13.md#^20251213-t1]] #book:開発生産性の教科書 #topic:reading ^20251213-l1
- [learning] ![[00.daily/2025-12-13.md#^20251213-t2]] #book:開発生産性の教科書 #topic:metrics ^20251213-l2
- [idea] 新しいワークフローのアイデア #topic:workflow #new:試験的タグ ^20251213-i1
- [action] 次にやること: 週次レビュー実施 status=todo #topic:productivity ^20251213-a1
```

### 4.5 ❌ NG 例

```
## INDEX

# NG1: TYPE が無い
- ![[00.daily/2025-12-13.md#^20251213-t1]] #book:開発生産性の教科書 ^20251213-l1

# NG2: Block ID が無い
- [learning] ![[00.daily/2025-12-13.md#^20251213-t1]] #book:開発生産性の教科書

# NG3: action に META が無い
- [action] 週次レビュー実施 #topic:productivity ^20251213-a1

# NG4: Block ID が命名規則違反
- [idea] アイデア #topic:workflow ^idea1

# NG5: タグが形式違反（prefix:value でない）
- [learning] ![[00.daily/2025-12-13.md#^20251213-t1]] #開発生産性の教科書 ^20251213-l1
```

---

## 5. タグ規約

### 5.1 タグ形式（基本）

- 形式：`#prefix:value`
- 空白は禁止（代わりに `_` を使う）

### 5.2 prefix 一覧

| prefix  | 意味           | 例                                       |
| ------- | -------------- | ---------------------------------------- |
| `book`  | 書籍名         | `#book:開発生産性の教科書`               |
| `tech`  | 技術           | `#tech:playwright`, `#tech:python`       |
| `topic` | テーマ         | `#topic:workflow`, `#topic:productivity` |
| `src`   | 文脈           | `#src:work`, `#src:personal`             |
| `new`   | 辞書外の仮タグ | `#new:試験的タグ`                        |
| `tmp`   | 一時タグ       | `#tmp:棚卸し予定`                        |

### 5.3 タグ運用フロー

1. 日次では `#prefix:value` か `#new:...` / `#tmp:...` をそのまま許容
2. 週次棚卸しで `taxonomy/tags.yml` の `approved` / `aliases` を更新
3. 更新後に `python scripts/etl.py --full` を実行して正規化を反映

### 5.4 書籍名に空白がある場合

- 空白は `_` に置換する

```
# ✅ OK
#book:The_Pragmatic_Programmer

# ❌ NG
#book:The Pragmatic Programmer
```

### 5.5 alias（同義語）の扱い

- `taxonomy/tags.yml` の `aliases` で正規化される
- 例：`#pw` → `tech:playwright`

---

## 6. Daily ノート生成時のチェックリスト

AI が Daily を生成する際は、以下を必ず確認すること：

- [ ] frontmatter に `date: YYYY-MM-DD` がある
- [ ] `## INDEX` セクションがある
- [ ] INDEX 行の行末に `^YYYYMMDD-<kind><n>` がある
- [ ] action 行には `effort=<分> status=<状態>` がある
- [ ] タグは `#prefix:value` 形式になっている
- [ ] Block ID の日付がファイル名の日付と一致している
- [ ] 同じ Block ID が重複していない
- [ ] コードブロックは ```` で囲まれている

---

## 7. テンプレート全文（コピペ用）

```
---
date: YYYY-MM-DD
tags: []
---

## Summary

（短文でその日の要約）

## Reading / Article Notes

（任意：読書・記事メモ。長文 OK）

## Key Takeaways (indexed)

- （ブログ化の核となる要点） ^YYYYMMDD-t1
- （...） ^YYYYMMDD-t2

## Log / Reflection

（任意：振り返り・自由記述）

## INDEX

- [learning] ![[00.daily/YYYY-MM-DD.md#^YYYYMMDD-t1]] #book:書籍名 #topic:テーマ ^YYYYMMDD-l1
- [idea] アイデアの短いラベル #topic:workflow ^YYYYMMDD-i1
- [action] 次にやること effort=30 status=inbox #topic:productivity ^YYYYMMDD-a1

## RAW

（任意：入力原文。後で再整形したい時の保険）
```

---

## 8. トラブルシュート

### ETL がスキップする主な原因

1. **`## INDEX` が無い**  
   → `## INDEX` セクションを追加する
2. **Block ID が無い**  
   → 各 INDEX 行の末尾に `^YYYYMMDD-<kind><n>` を付ける
3. **action に META が無い**  
   → `effort=<分> status=<状態>` を追加する
4. **タグ形式が不正**  
   → `#prefix:value` に修正する
5. **Block ID の日付が不一致**  
   → ファイル名が `2025-12-13.md` なら Block ID は `^20251213-...` にする
