# 実装ステップガイド（新人向け）

日次テンプレと INDEX 規約を前提に、「環境準備→初回実行→キャッチアップ→ブログ化」までを手順化。迷ったらここを上から順に実行すれば形になる構成。

---

## 0. 事前前提

- macOS、Python 3.11+ が入っていること
- 本リポジトリを VS Code で開いていること（Obsidian は閲覧専用）
- Vault ルートがカレントディレクトリ（例：`pwd` が Vault 直下）

---

## 1. 環境準備

1. 仮想環境を用意（任意だが推奨）
   - `python3 -m venv .venv`
   - `source .venv/bin/activate`
2. 依存インストール（requirements.txt がある場合）
   - `pip install -r requirements.txt`
   - 無い場合、最低限：`pip install pyyaml`
3. ディレクトリ確認/作成（無ければ作る）
   - `daily/`, `db/`, `scripts/`, `taxonomy/`, `index/`, `exports/`, `drafts/`
4. DB を初期化
   - `sqlite3 db/notes.sqlite < init_db.sql`（init_db.sql を後述の DDL で用意）
5. タグ辞書の雛形を作成（例）
   ```yaml
   # taxonomy/tags.yml
   approved:
     book: []
     tech: []
     topic: []
     src: []
   rules:
     allow_new_prefix: ["new", "tmp"]
   aliases: {}
   ```

---

## 2. Day1 動作確認（最小ループ）

1. サンプル daily を作る（例：`daily/2025-01-01.md`）
   - docs/ai-instructions.md のテンプレに従い、`## INDEX` を 1 行以上入れる
2. ETL 全走査
   - `python scripts/etl.py --full`
   - 期待：files_scanned が 1 以上、failed が 0
3. index 再生成
   - `python scripts/build_index.py`
   - 期待：`index/ideas.md`, `index/actions.md`, `index/books/` が生成
4. Obsidian で確認
   - Vault を開き、`index/actions.md` からブロック参照が飛べることを確認

---

## 3. 日次運用（毎日）

1. VS Code で自然文を書く
2. AI（Copilot 等）で日次テンプレに沿って整形し、block_id と INDEX を付ける
3. `python scripts/etl.py --since 7`（または何も付けず全走査）
4. `python scripts/build_index.py`
5. Obsidian で `index/actions.md` を確認

---

## 4. サボった後のキャッチアップ

1. `python scripts/etl.py --full`
2. `python scripts/build_index.py`
3. ログに failed 行があれば `logs/etl_errors.log` と `quarantine/` を確認し修正

---

## 5. ブログ化フロー

1. 抽出パック生成（例）
   - `python scripts/export_pack.py --tag "book:開発生産性の教科書" --from 2025-11-01 --to 2025-12-31 --type learning`
2. exports/\*.md を AI に渡し、`drafts/` に下書きを生成
3. Obsidian でドラフトを開き、必要なら原本ブロックに戻って文脈を補強

---

## 6. タグ棚卸し（週次推奨）

1. `taxonomy/tags.yml` の approved/aliases を更新（new/tmp を整理）
2. 更新後に `python scripts/etl.py --full` で正規化を反映
3. `python scripts/build_index.py` で索引を再生成

---

## 7. バリデーション（任意だが推奨）

- `python scripts/validate_daily.py --since 7`
  - INDEX 欠落、block_id 不一致、action meta 欠落、タグ形式不正を検出
  - エラーがあれば daily を修正して再実行

---

## 8. トラブルシュート早見表

- INDEX 無し：`## INDEX` を追加し、最低1行を書く
- block_id 無し：`^YYYYMMDD-<kind><n>` を末尾に付与
- action meta 無し：`effort=<分>` と `status=inbox|doing|done|dropped` を追加
- タグに空白：値の空白を `_` に置換（例：`#book:The_Pragmatic_Programmer`）
- failed 行がある：`logs/etl_errors.log` と `quarantine/` を見て修正→再度 `etl --full`

---

## 9. 次のステップ（準備するもの）

- `init_db.sql` を docs/detailed_design.md の DDL に合わせて作成
- `docs/ai-instructions.md` に OK/NG 例とテンプレ全文を記載（Copilot 参照用）
- scripts/\*.py を実装し、上記コマンドが通ることを Day1 で確認
