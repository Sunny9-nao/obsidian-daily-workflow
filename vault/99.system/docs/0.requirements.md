# 要件定義

## 1. 背景

- 日次の振り返りやメモを続けたいが、「文章を整える/まとめる」コストが高く、継続が難しくなりがち
- 読書や記事の学びをブログ化したいが、「読み終えてから一気に書く」は負荷が高く、後回しになりやすい
- 日々のメモに埋もれがちなアイディアを、後から活用できる形で取り出したい

## 2. 目的

1. **AI 経由で日次ノートを整形**し、文章を考えるコストを減らして継続しやすくする
2. 日次ノートを「後でブログ化しやすい形」に残し、**日次メモ → ブログ下書き**へ流用できる仕組みを作る
3. アイディアを索引化し、好きなタイミングで取り出して「やってみる」につなげる

### 2.1 成功/品質基準（定量）

- 日次生成〜ETL完了まで 5 分以内（新人が Day1 で再現できること）
- ETL 失敗率 < 1%（失敗行はログ化し 24 時間以内に修復できること）
- index 再生成 1 分以内（フル再生成しても待てる体感）
- ブログ下書き着手までのリードタイムを日次+3日以内にできること
- オンボーディング：新規参加者が「手順書を見て Day1 の一連操作（daily作成→etl→index閲覧）」を 30 分以内で完了できること

## 3. 基本方針（設計原則）

- **運用は VS Code 中心**：編集・AI 利用・スクリプト実行は VS Code で行う
- **Obsidian は閲覧・探索・関連発見に特化**：バックリンク/グラフ/リンク辿りで材料を発見し、ブログ化・活用に繋げる
- **Markdown が一次情報（正）**：ブログ化に必要な文脈・長文は Markdown に残す
- **索引は機械処理しやすく**：日次ノート内に、スクリプトが安定して読める「INDEX ブロック（固定文法）」を設ける（JSON は使わない）
- **原本へ確実に戻れる**：INDEX は Obsidian のブロック参照（`^block-id`）で原本の該当箇所へ戻れるようにする
- **AI の自由度は本文に寄せる**：自由記述（長文）と機械が読む部分（INDEX）を分離して壊れにくくする
- **AI 出力の一貫性を担保する**：日次テンプレ、INDEX 固定文法、ブロック ID 命名規則、タグ規約などの“プロジェクト規約”を明文化し、VS Code 上の AI 利用（例：GitHub Copilot）で参照させ、規約逸脱を減らす

## 4. 技術選定（理由：簡潔）

- **VS Code**：普段の開発・文章編集・AI 利用に慣れており、日次作成を「いつもの作業環境」に統合できる
- **Obsidian**：ローカルで Markdown を直接扱え、バックリンク/グラフ等により「見返し・探索・関連発見」が強く、日次メモをブログ化・アイデア活用へ繋げやすい
- **Markdown（Vault）**：一次情報としての可搬性が高く、将来のツール変更にも強い
- **SQLite（索引用 DB）**：ローカルで運用が軽く、索引・抽出・一覧生成に十分な性能を持つ
- **Python（スクリプト）**：テキスト処理（INDEX 抽出）と SQLite 操作が容易で、新人でも実装・保守しやすい
- **GitHub Copilot（カスタムインストラクション）**：プロジェクト規約（テンプレ/INDEX 文法/タグ/実装方針）の遵守率を上げ、日次生成と実装作業のブレを減らす

## 5. 対象データ（扱う情報）

- 日次の振り返り・ログ（自由文）
- 読書/記事メモ（長文 OK）
- ブログ化の核となる要点（Key Takeaways）
- アイディア（Idea）
- 試したこと（Experiment）
- 次の一手（Action：15/30/60/90 分粒度＋状態）
- タグ（例：book/tech/topic/src 等）

## 6. 機能要件

### 6.1 日次ノート生成（AI 整形）

- ユーザーは自然言語で入力する
- AI は `daily/YYYY-MM-DD.md` を一定フォーマットで生成する
- 読書・記事の感想は長文で自由に書けること
- 後続処理のために索引ブロック（INDEX）を必ず含むこと
- INDEX は固定文法で、スクリプトが安定してパースできること
- 各索引対象にはブロック ID（`^...`）を付与し、原本へ確実に戻れること

### 6.2 タグ運用（揺れ対策）

- タグは `prefix:value` 形式を基本とする（例：`book:書籍名`、`tech:playwright`、`topic:workflow`）
- タグ辞書（taxonomy）を持ち、既存タグの選択を優先する
- 辞書にないタグは `new:` として一時的に許可し、棚卸しで収束させる
- alias（同義語）を許容し、正規化はスクリプト側で担保する

### 6.3 索引化（DB 格納）

- 定期的に `daily/*.md` を走査し、INDEX から索引データを抽出して DB へ格納する
- 重複が起きない（同一日・同一 block_id は更新扱い）こと
- DB には長文本文を入れず、索引として必要最小限を保持すること
  - date / type / tags /（action なら effort/status）
  - source_path / block_id（原本参参照用）

### 6.4 Obsidian での活用導線（索引ノート生成）

- DB から一覧を生成し、Obsidian で見返せる索引ノートとして出力できること
  - Ideas 一覧
  - 未処理 Action 一覧
  - 書籍（`book:`）単位の一覧
  - （必要に応じて）タグ単位の一覧
- 各行はブロック参照で原本へ遷移できること（文脈回収ができる）

### 6.5 ブログ化支援（集約・分析）

- タグ（例：`book:書籍名`）や期間で抽出し、AI に渡すための抽出パック（exports）を生成できること
- AI は抽出パックを元に、以下を行えること
  - 要点の重複統合（言い換えをまとめる）
  - テーマ分類（章立て）
  - 主張の一本化
  - ブログ下書き Markdown 生成（`drafts/`に保存）
- ブログ下書きには参照元（どの日のどのブロックか）を残せること

## 7. 非機能要件（運用・品質）

- **継続しやすさ**：日次作成は「自然文 →AI 整形」で完了すること
- **壊れにくさ**：本文が揺れても INDEX が取れれば処理できること
- **止まらない**：パース失敗があっても全体停止せず、失敗箇所はログ化できること
- **ローカル完結**：VS Code と Obsidian の運用で完結し、作業の中心は Vault 内で閉じること
- **新人でも実装可能**：正規表現＋ SQLite ＋ Markdown 生成で実装できること
- **運用性（AI 支援の再現性）**：AI が生成する日次ノートやコードの品質を安定させるため、プロジェクト内に「AI 向け規約文書（カスタムインストラクション）」を配置し、以下を必須ルールとして含める
  - Daily ノートの必須セクション構成
  - INDEX 行の固定文法（パース契約）
  - ブロック ID 命名規則（`^YYYYMMDD-...`）
  - タグ規約（`#prefix:value`、辞書参照、`#new:`運用）
  - ETL は INDEX のみを解析し、失敗行があっても停止しない
  - コードブロック表記は ```` を使用する

## 8. 前提条件

- macOS
- VS Code を主に使用（編集・AI・スクリプト実行）
- Obsidian を使用（閲覧・探索）
- Vault の命名規則：`daily/YYYY-MM-DD.md`
- JSON は使わず、INDEX 固定文法で抽出する方針

## 9. 成果物

- 日次ノート（Markdown）
- 索引用 DB（SQLite）
- Obsidian 用索引ノート（index/\*.md）
- ブログ化用抽出パック（exports/\*.md）
- ブログ下書き（drafts/\*.md）
- タグ辞書（taxonomy/tags.yml）
- スクリプト一式（scripts/）
- AI 向け規約文書（例：`docs/ai-instructions.md` など。名称・配置は設計で決定）
- 実装ステップ手順書（例：`docs/impl_steps.md`、Day1〜キャッチアップ手順を記載）
